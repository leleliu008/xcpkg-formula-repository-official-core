summary: A general-purpose, portable utility library which provides many useful data types, macros, type conversions, string utilities, file utilities, a mainloop abstraction, and so on
web-url: https://developer.gnome.org/glib
git-url: https://github.com/GNOME/glib
src-url: https://download.gnome.org/sources/glib/2.84/glib-2.84.4.tar.xz
src-sha: 8a9ea10943c36fc117e253f80c91e477b673525ae45762942858aef57631bb90
license: LGPL-2.1-or-later
dep-pkg: libpcre2 libintl libffi libz
dep-upp: gettext-tools

dopatch: |
    gsed -i "s|dependency('intl'|dependency('libintl'|" meson.build
    gsed -i "s|dependency('iconv')|dependency('libiconv')|" meson.build
    gsed -i "s|cc.find_library('resolv')|declare_dependency(link_args : ['-lresolv'])|" gio/meson.build

# https://docs.gtk.org/glib/building.html
install: |
    mesonw \
        -Dintrospection=disabled \
        -Ddocumentation=false \
        -Dman-pages=disabled \
        -Dsysprof=disabled \
        -Dselinux=disabled \
        -Ddtrace=disabled \
        -Dnls=disabled \
        -Dlibelf=disabled \
        -Dlibmount=disabled \
        -Dglib_debug=disabled \
        -Dglib_assert=false \
        -Dxattr=false \
        -Dtests=false \
        -Dinstalled_tests=false \
        -Dbsymbolic_functions=false

dotweak: gsed -i -e 's|libiconv|libintl libffi libz|' -e 's|-lintl|-lresolv|g' lib/pkgconfig/glib-2.0.pc
