summary: OCR (Optical Character Recognition) engine
src-url: https://github.com/tesseract-ocr/tesseract/archive/refs/tags/5.5.1.tar.gz
src-sha: a7a3f2a7420cb6a6a94d80c24163e183cf1d2f1bed2df3bbc397c81808a57237
license: Apache-2.0
dep-pkg: libicu libpango libleptonica libarchive libcurl
dep-lib: libarchive libcurl
ldflags: -framework Foundation -framework CoreFoundation -framework SystemConfiguration -framework ApplicationServices

dopatch: |
    Leptonica_LIBRARIES="$(pkg-config --libs-only-l lept | tr ' ' ';')"
    Leptonica_VERSION="$(pkg-config --modversion lept)"

    cat > cmake/FindLeptonica.cmake <<EOF
    set(Leptonica_INCLUDE_DIRS "$libleptonica_INCLUDE_DIR/leptonica")
    set(Leptonica_LIBRARIES    "$Leptonica_LIBRARIES")
    set(Leptonica_VERSION      "$Leptonica_VERSION")

    include(FindPackageHandleStandardArgs)
    find_package_handle_standard_args(Leptonica REQUIRED_VARS Leptonica_LIBRARIES Leptonica_INCLUDE_DIRS VERSION_VAR Leptonica_VERSION)
    mark_as_advanced(Leptonica_INCLUDE_DIRS Leptonica_LIBRARIES)
    EOF

    gsed -i '/find_package(Leptonica/s|CONFIG||' CMakeLists.txt

    ####################################################################

    PANGOCAIRO_LIBRARIES="$(pkg-config --libs-only-l pangocairo) -lintl -lpixman-1 -lffi  -lpcre2-8"
    echo "$PANGOCAIRO_LIBRARIES=$PANGOCAIRO_LIBRARIES"
    gsed -i "s|PkgConfig::PANGO|$PANGOCAIRO_LIBRARIES|" src/training/CMakeLists.txt

install: |
    cmakew \
        -DENABLE_LTO=ON \
        -DUSE_SYSTEM_ICU=ON \
        -DDISABLE_ARCHIVE=OFF \
        -DDISABLE_CURL=OFF \
        -DBUILD_TESTS=OFF \
        -DBUILD_TRAINING_TOOLS=ON \
        -DBUILD_SHARED_LIBS=OFF

dotweak: rm -rf include/ lib/
