pkgtype: exe+lib
summary: Cryptographic and SSL/TLS library
web-url: https://tls.mbed.org
src-url: https://github.com/Mbed-TLS/mbedtls/releases/download/mbedtls-4.0.0/mbedtls-4.0.0.tar.bz2
src-sha: 2f3a47f7b3a541ddef450e4867eeecb7ce2ef7776093f3a11d6d43ead6bf2827
license: Apache-2.0
dep-pkg: libz

dopatch: |
    gsed -i \
         -e 's|//#define MBEDTLS_THREADING_PTHREAD|#define MBEDTLS_THREADING_PTHREAD|' \
         -e 's|//#define MBEDTLS_THREADING_C|#define MBEDTLS_THREADING_C|' \
         tf-psa-crypto/include/psa/crypto_config.h

    gsed -i 's|//#define MBEDTLS_SSL_DTLS_SRTP|#define MBEDTLS_SSL_DTLS_SRTP|' include/mbedtls/mbedtls_config.h

install: |
    cmakew \
        -DUSE_STATIC_MBEDTLS_LIBRARY=ON \
        -DUSE_SHARED_MBEDTLS_LIBRARY=ON \
        -DUSE_PKCS11_HELPER_LIBRARY=OFF \
        -DUNSAFE_BUILD=OFF \
        -DMBEDTLS_FATAL_WARNINGS=OFF \
        -DINSTALL_MBEDTLS_HEADERS=ON \
        -DENABLE_PROGRAMS=ON \
        -DENABLE_TESTING=OFF \
        -DENABLE_ZLIB_SUPPORT=ON
