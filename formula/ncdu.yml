summary: A disk usage analyzer with an ncurses interface
web-url: https://dev.yorhel.nl/ncdu
src-url: https://dev.yorhel.nl/download/ncdu-2.9.2.tar.gz
src-sha: e91135281cb66569f2ca4c0bac277246991e7e52524c0ca8cba3de5c8e81cec9
license: MIT
dep-pkg: libncurses libzstd
bsystem: zig@0.15

dopatch: |
    if [ -f ../lib/libzstd.a ] ; then
        run ln -s ../lib/libncursesw.a libncursesw.a
        run ln -s ../lib/libzstd.a     libzstd.a

        gsed -i "s|linkSystemLibrary(\"ncursesw\", \.{})|addObjectFile(b.path(\"libncursesw.a\"))|" build.zig
        gsed -i "s|linkSystemLibrary(\"zstd\", \.{})|addObjectFile(b.path(\"libzstd.a\"))|" build.zig
    fi

install: |
    zig -Doptimize=ReleaseSafe -Dpie=true -Dstrip=true --search-prefix "$libncurses_INSTALL_DIR" --search-prefix "$libzstd_INSTALL_DIR"
    install_mans ncdu.1

caveats: |
    you might need to set these environment variables:

    export TERM=xterm-256color
    export TERMINFO=/usr/share/terminfo
